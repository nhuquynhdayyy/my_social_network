<!-- posts/templates/posts/_post_interactive_section.html -->
{% load post_extras %}
<!-- Pháº§n Reaction -->

<!-- VÃ¹ng hiá»ƒn thá»‹ thá»‘ng kÃª (sá»‘ lÆ°á»£ng vÃ  icon) -->
<div class="d-flex justify-content-between align-items-center my-2">
    <a href="#" 
    id="reaction-stats-{{ post.id }}" 
    class="d-flex align-items-center text-decoration-none text-dark reaction-stats-trigger"
    style="font-size: 0.9rem;"
    data-bs-toggle="modal" 
    data-bs-target="#reactionListModal"
    data-post-id="{{ post.id }}">
        
        {% with stats=post.get_reaction_stats %}
            {% if stats %}
                <div class="me-2">
                    {% if 'LIKE' in stats %}<span>ğŸ‘</span>{% endif %}
                    {% if 'LOVE' in stats %}<span>â¤ï¸</span>{% endif %}
                    {% if 'HAHA' in stats %}<span>ğŸ˜‚</span>{% endif %}
                    {% if 'WOW' in stats %}<span>ğŸ˜®</span>{% endif %}
                    {% if 'SAD' in stats %}<span>ğŸ˜¢</span>{% endif %}
                    {% if 'ANGRY' in stats %}<span>ğŸ˜¡</span>{% endif %}
                </div>
                <span id="reactions-count-{{ post.id }}">{{ post.reactions.count }}</span>
            {% else %}
                <span id="reactions-count-{{ post.id }}" class="text-muted"></span>
            {% endif %}
        {% endwith %}
    </a>
</div>

<!-- VÃ¹ng cÃ¡c nÃºt báº¥m tÆ°Æ¡ng tÃ¡c (ThÃ­ch, BÃ¬nh luáº­n, Chia sáº») -->
<div class="d-flex justify-content-around py-1">
    
    <!-- NÃºt ThÃ­ch (Container chÃ­nh cho popup) -->
    <div class="post-reaction-container flex-fill text-center">
        
        <!-- Popup chá»©a cÃ¡c icon reaction (sáº½ hiá»‡n khi hover) -->
        <div class="post-reaction-popup">
            <button class="btn reaction-btn" data-post-id="{{ post.id }}" data-reaction-type="LIKE">ğŸ‘</button>
            <button class="btn reaction-btn" data-post-id="{{ post.id }}" data-reaction-type="LOVE">â¤ï¸</button>
            <button class="btn reaction-btn" data-post-id="{{ post.id }}" data-reaction-type="HAHA">ğŸ˜‚</button>
            <button class="btn reaction-btn" data-post-id="{{ post.id }}" data-reaction-type="WOW">ğŸ˜®</button>
            <button class="btn reaction-btn" data-post-id="{{ post.id }}" data-reaction-type="SAD">ğŸ˜¢</button>
            <button class="btn reaction-btn" data-post-id="{{ post.id }}" data-reaction-type="ANGRY">ğŸ˜¡</button>
        </div>

        <!-- NÃºt "ThÃ­ch" máº·c Ä‘á»‹nh, luÃ´n hiá»ƒn thá»‹ -->
        {% with user_reaction=user_reactions_map|get_item:post.id %}
        <button 
            class="btn btn-interactive reaction-btn w-100 {% if user_reaction %}reaction-active{% endif %}" 
            data-post-id="{{ post.id }}" data-reaction-type="LIKE">
            
            {% if user_reaction == 'LIKE' %}
                <span class="reaction-icon-liked">ğŸ‘</span> ThÃ­ch
            {% elif user_reaction == 'LOVE' %}
                <span class="reaction-icon-loved">â¤ï¸</span> YÃªu thÃ­ch
            {% elif user_reaction == 'HAHA' %}
                <span class="reaction-icon-haha">ğŸ˜‚</span> Haha
            {% elif user_reaction == 'WOW' %}
                <span class="reaction-icon-wow">ğŸ˜®</span> Wow
            {% elif user_reaction == 'SAD' %}
                <span class="reaction-icon-sad">ğŸ˜¢</span> Buá»“n
            {% elif user_reaction == 'ANGRY' %}
                <span class="reaction-icon-angry">ğŸ˜¡</span> Pháº«n ná»™
            {% else %}
                <svg fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" viewBox="0 0 24 24" class="interactive-icon"><path d="M14 9V5a3 3 0 0 0-3-3l-4 9v11h11.28a2 2 0 0 0 2-1.7l1.38-9a2 2 0 0 0-2-2.3zM7 22H4a2 2 0 0 1-2-2v-7a2 2 0 0 1 2-2h3"></path></svg>
                ThÃ­ch
            {% endif %}
        </button>
        {% endwith %}
    </div>

    <!-- NÃºt BÃ¬nh luáº­n -->
    <div class="flex-fill text-center">
        <button class="btn btn-interactive w-100 comment-button" data-post-id="{{ post.id }}">
            <svg fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" viewBox="0 0 24 24" class="interactive-icon"><path d="M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z"></path></svg>
            BÃ¬nh luáº­n
        </button>
    </div>
    
    <!-- NÃºt Chia sáº» (Giáº£) -->
    <div class="flex-fill text-center">
        <button class="btn btn-interactive w-100">
            <svg fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" viewBox="0 0 24 24" class="interactive-icon"><path d="M4 12v8a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2v-8m-4-6-4-4-4 4m4-4v13"></path></svg>
            Chia sáº»
        </button>
    </div>
</div>


<!-- Pháº§n BÃ¬nh luáº­n -->
<div class="comments-section mt-3" id="comments-section-{{ post.id }}">
    <!-- Danh sÃ¡ch cÃ¡c bÃ¬nh luáº­n Ä‘Ã£ cÃ³ -->
    <div class="comment-list">
        {% for comment in post.get_initial_comments %}
            {% include 'posts/_single_comment.html' with comment=comment post=post comment_user_reactions_map=comment_user_reactions_map %}
        {% endfor %}
    </div>

    <!-- NÃºt "Xem thÃªm bÃ¬nh luáº­n" -->
    {% with initial_count=post.get_initial_comments.count %}
        {% if post.comment_count > initial_count %}
            <div class="mt-2 text-center">
                <a href="#" 
                class="text-decoration-none fw-bold load-more-comments" 
                data-post-id="{{ post.id }}" 
                data-offset="{{ initial_count }}">
                    Xem thÃªm bÃ¬nh luáº­n
                </a>
                <div class="spinner-border spinner-border-sm ms-2 d-none" role="status">
                    <span class="visually-hidden">Loading...</span>
                </div>
            </div>
        {% endif %}
    {% endwith %}
    
    <!-- Form thÃªm bÃ¬nh luáº­n -->
    {% if user.is_authenticated %}
        <form class="comment-form mt-2" method="POST" action="{% url 'posts:add_comment' post_id=post.id %}">
            {% csrf_token %}
            <div class="comment-input-wrapper">
                <input type="text" name="content" class="form-control comment-input-ig" id="comment-input-{{ post.id }}" placeholder="ThÃªm bÃ¬nh luáº­n..." autocomplete="off">
                <button type="submit" class="btn btn-link comment-submit-btn d-none">Gá»­i</button>
            </div>
        </form>
    {% endif %}
</div>
<!-- Káº¿t thÃºc pháº§n BÃ¬nh luáº­n -->